# 🎮 遗忘的像素魔法大陆

> 一个关于迷雾、魔法与记忆的像素探索游戏  
> **v1.0.0** - 前后端分离架构 + 完整数据持久化系统

🔥 **立即运行**: 查看 [HOW_TO_RUN.md](./HOW_TO_RUN.md) （只阀3步！）

---

## 🚀 快速开始（3步）

### 1️⃣ 安装依赖

```bash
# 方式1: 一键安装所有依赖（推荐）
npm run install:all

# 方式2: 分别安装
npm install                    # 根目录
cd frontend && npm install     # 前端
cd ../backend && npm install   # 后端
cd ..
```

### 2️⃣ 配置环境变量（可选）

```bash
# 复制环境变量模板
cp frontend/.env.example frontend/.env
cp backend/.env.example backend/.env

# 默认配置即可使用，无需修改
```

### 3️⃣ 启动开发服务器

```bash
# 同时启动前端和后端（推荐）
npm run dev

# 或分别启动
npm run dev:frontend    # 前端: http://localhost:5173
npm run dev:backend     # 后端: http://localhost:3000
```

**访问游戏**：打开浏览器访问 http://localhost:5173

---

## 📁 项目结构

```
program1/
├── frontend/              # 🎨 前端应用
│   ├── src/
│   │   ├── game/         # Phaser 游戏逻辑
│   │   ├── ui/           # React UI 组件
│   │   ├── store/        # Zustand 状态管理
│   │   ├── services/     # 🆕 数据服务（压缩、IndexedDB、云同步）
│   │   ├── constants/    # 游戏配置
│   │   └── types/        # TypeScript 类型
│   ├── public/           # 静态资源
│   └── package.json
│
├── backend/               # 🔧 后端服务
│   ├── src/
│   │   ├── config/       # 数据库配置
│   │   ├── controllers/  # API 控制器
│   │   ├── services/     # 业务逻辑（存档、同步）
│   │   ├── routes/       # 路由定义
│   │   └── models/       # 数据模型
│   ├── database/
│   │   └── sqlite/       # SQLite 数据库文件
│   └── package.json
│
├── docs/                  # 📚 项目文档
│   ├── 数据持久化系统v2.0.md
│   ├── 游戏设计文档.md
│   └── ...
│
├── package.json           # Workspace 配置
└── README.md              # 本文件
```

---

## ✨ 核心特性

### 🎮 游戏系统
- **Phaser 3 游戏引擎** - 流畅的像素风格渲染
- **迷雾探索系统** - 动态地图探索
- **战斗系统** - 实时战斗 + 技能系统
- **装备系统** - 背包、装备、物品管理
- **任务系统** - 主线/支线任务
- **等级成长** - 1-50级，自由选择成长路线

### 💾 数据持久化 v2.0
- **多存储方案**：LocalStorage / IndexedDB / Cloud
- **自动压缩**：>100KB 数据自动 gzip 压缩（压缩率 70-80%）
- **多存档槽位**：支持 3 个独立存档
- **云同步**：实时同步到服务器，支持多设备
- **版本控制**：完整的同步历史记录
- **冲突解决**：智能合并本地和云端数据

### 🛠️ 技术栈

**前端**
- React 18 + TypeScript 5
- Phaser 3.80（游戏引擎）
- Vite 5（构建工具）
- Zustand 4（状态管理）
- TailwindCSS（样式）
- IndexedDB + pako（本地存储 + 压缩）

**后端**
- Node.js 20 + Express 4
- TypeScript 5
- SQLite 3（Better-SQLite3）
- zlib（数据压缩）
- JWT（可选认证）

---

## 🛠️ 常用命令

### 开发命令

```bash
# 启动开发服务器（同时启动前后端）
npm run dev

# 分别启动
npm run dev:frontend      # 前端: http://localhost:5173
npm run dev:backend       # 后端: http://localhost:3000

# 构建生产版本
npm run build             # 构建前后端
npm run build:frontend    # 只构建前端
npm run build:backend     # 只构建后端

# 启动生产服务器
npm run start             # 启动后端生产服务器
```

### 代码质量

```bash
# Lint 检查
npm run lint              # 检查前端代码

# 测试
npm run test              # 运行所有测试
npm run test:frontend     # 前端测试
npm run test:backend      # 后端测试
```

### 数据库管理

```bash
cd backend

# 数据库迁移（如果需要）
npm run db:migrate

# 数据填充（开发/测试）
npm run db:seed
```

---

## ⚠️ 故障排除

### 问题1：端口被占用

**错误**：`Error: listen EADDRINUSE: address already in use :::5173`

**解决**：
```bash
# 查找占用端口的进程
lsof -ti:5173 | xargs kill -9  # 关闭 5173 端口
lsof -ti:3000 | xargs kill -9  # 关闭 3000 端口

# 或修改端口：
# 前端: 编辑 frontend/vite.config.ts 中的 server.port
# 后端: 编辑 backend/.env 中的 PORT
```

### 问题2：模块找不到

**错误**：`Cannot find module 'xxx'`

**解决**：
```bash
# 删除所有 node_modules 并重新安装
rm -rf node_modules frontend/node_modules backend/node_modules
rm -rf package-lock.json frontend/package-lock.json backend/package-lock.json
npm run install:all
```

### 问题3：TypeScript 错误

**错误**：各种 TS 类型错误

**解决**：
```bash
# 确保所有依赖已安装
cd frontend && npm install
cd ../backend && npm install

# 重启 IDE/编辑器
```

### 问题4：数据库错误

**错误**：Backend 数据库连接失败

**解决**：
```bash
# 确保数据库目录存在
mkdir -p backend/database/sqlite

# 检查文件权限
chmod -R 755 backend/database

# 删除旧数据库并重启（注意：会丢失数据）
rm backend/database/sqlite/*.db
npm run dev:backend
```

### 问题5：前后端无法通信

**错误**：CORS 错误或连接拒绝

**解决**：
1. 确保后端正在运行：`npm run dev:backend`
2. 检查环境变量：`frontend/.env` 中的 `VITE_API_URL`
3. 检查后端 CORS 配置：`backend/.env` 中的 `CORS_ORIGIN`

---

## 📚 文档导航

所有文档位于 [`docs/`](./docs/) 目录下：

### 🔥 快速入门
- **[迁移指南](./MIGRATION_GUIDE.md)** - 从旧版本升级到v1.0（必读）⭐
- **[项目重构说明](./PROJECT_RESTRUCTURE.md)** - v1.0架构详解
- **[数据持久化系统v2.0](./docs/数据持久化系统v2.0.md)** - 完整使用指南
- **[后端API文档](./backend/README.md)** - 服务器端API参考
- **[前端开发文档](./docs/前端开发文档.md)** - 项目结构和开发指南

### 🎮 游戏设计
- **[游戏设计文档](./docs/游戏设计文档.md)** - 世界观与核心玩法
- **[视觉设计指南](./docs/视觉设计指南.md)** - 像素美术规范
- **[优化建议汇总](./docs/优化建议汇总.md)** - 创新机制设计

### 💻 技术文档
- **[技术架构文档](./docs/技术架构文档.md)** - 完整技术方案（15000字）
- **[功能特性列表](./docs/功能特性列表.md)** - 160+功能清单
- **[开发路线图](./docs/开发路线图.md)** - 10-13个月开发计划

### 🔧 Windsurf开发规则（AI必读）⭐⭐⭐
- **[项目全局规则](./.cursor/rules/project-overview-rules.mdc)** - 项目概览和规范（必读）
- **[游戏设计规则](./.cursor/rules/game-design-rules.mdc)** - 设计原则
- **[技术架构规则](./.cursor/rules/tech-architecture-rules.mdc)** - 代码规范

---

## 📊 项目概览

### 1. [游戏设计文档](./docs/游戏设计文档.md) 📖
**完整的游戏设计规划**
- 世界观与背景故事
- 核心玩法系统
- 角色成长机制
- 叙事设计
- 目标玩家画像

**适合阅读对象**：所有团队成员、投资人、合作伙伴

---

### 2. [优化建议汇总](./docs/优化建议汇总.md) 💡
**游戏体验提升方案**
- 5大核心机制优化
- 创新玩法扩展
- 功能优先级矩阵
- 实施建议与风险控制

**适合阅读对象**：游戏设计师、制作人

**关键亮点**：
- ✨ 智能迷雾AI系统
- ✨ 魔法融合战斗
- ✨ 可玩的记忆片段
- ✨ 动态村庄系统
- ✨ 生态恢复反馈

---

### 3. [开发路线图](./docs/开发路线图.md) 🗺️
**详细的开发时间表**
- 4个开发阶段（共10-13个月）
- 每阶段的具体任务清单
- 资源需求与成本估算
- 风险管理策略

**适合阅读对象**：程序员、项目经理、制作人

**里程碑**：
- 🎯 原型阶段（1个月）：可玩Demo
- 🎯 MVP阶段（3个月）：1-2小时核心体验
- 🎯 完整版阶段（7个月）：12-15小时完整游戏
- 🎯 打磨阶段（9个月）：可发布版本

---

### 4. [视觉设计指南](./docs/视觉设计指南.md) 🎨
**像素美术标准与规范**
- 像素规格与色彩方案
- 角色与敌人设计
- 环境与特效设计
- UI/UX设计规范
- 美术资源清单

**适合阅读对象**：美术、动画师、UI设计师

**核心理念**：温暖的神秘感 - 简洁即美

---

### 5. [技术架构文档](./docs/技术架构文档.md) 💻
**完整的技术实施方案**
- 技术栈选型（Vite + Phaser 3 + React + TypeScript）
- 项目结构设计
- 核心系统架构（战斗、迷雾、AI等）
- 性能优化策略
- 部署方案

**适合阅读对象**：程序员、技术负责人

**技术栈亮点**：
- 🚀 Vite 5 - 极速开发体验
- 🎮 Phaser 3 - 成熟的2D游戏引擎
- ⚛️ React 18 - UI界面
- 📘 TypeScript 5 - 类型安全
- 🐻 Zustand - 轻量状态管理

---

### 6. [功能特性列表](./docs/功能特性列表.md) 📋
**160+功能清单与优先级**
- 按系统分类的完整功能列表
- 优先级标注（P0-P3）
- 实现难度评估
- 开发阶段分配

**适合阅读对象**：全体团队成员

**使用方式**：打印作为开发检查清单

---

## 🎮 游戏核心概念

### 世界观
- **设定**：被"永恒迷雾"吞噬的魔法大陆
- **主角**：失忆的村民，唯一能够驱散迷雾的人
- **目标**：收集魔法精华，揭开大陆的秘密，恢复世界生机

### 核心玩法
1. **探索**：在迷雾中发现遗迹、宝藏、故事碎片
2. **战斗**：使用元素魔法对抗迷雾生物
3. **成长**：升级技能、强化装备、解锁新能力
4. **叙事**：通过环境和记忆碎片拼凑完整故事

### 独特卖点
- 🌫️ **智能迷雾**：会学习玩家行为的动态敌对系统
- ⚗️ **魔法融合**：不同元素可以组合出新效果
- 🏘️ **活的村庄**：随玩家推进而繁荣的据点
- 📜 **情感叙事**：可玩的记忆片段和环境故事

---

## 👥 贡献指南

欢迎贡献！请遵循以下步骤：

1. Fork 本仓库
2. 创建特性分支：`git checkout -b feature/AmazingFeature`
3. 提交修改：`git commit -m 'Add some AmazingFeature'`
4. 推送分支：`git push origin feature/AmazingFeature`
5. 提交 Pull Request

---

## 📊 项目概览

### 开发规模
- **预计开发时间**：10-13个月
- **目标游戏时长**：12-15小时（主线）
- **目标平台**：PC（Steam）
- **团队规模**：1-3人（独立/小团队）

### 技术栈建议
- **游戏引擎**：Unity / Godot / GameMaker
- **美术工具**：Aseprite（像素动画）
- **音效**：外包或素材库

### 预算估算
- **最小预算**（自己做美术）：$500-1000（工具+音效）
- **中等预算**（部分外包）：$3000-6000
- **理想预算**（全外包美术）：$8000-14000

---

## 🎯 快速开始指南

### 如果你是...

#### 🎨 **美术设计师**
1. 阅读 [视觉设计指南](./视觉设计指南.md)
2. 下载推荐工具（Aseprite）
3. 从主角色设计开始
4. 参考"美术资源清单"规划工作量

#### 💻 **程序员**
1. 阅读 [游戏设计文档](./游戏设计文档.md) 了解核心系统
2. 查看 [开发路线图](./开发路线图.md) 的技术任务
3. 搭建基础项目结构（参考第一阶段）
4. 先实现核心循环（移动→战斗→收集）

#### 🎮 **游戏设计师**
1. 通读 [游戏设计文档](./游戏设计文档.md)
2. 研究 [优化建议汇总](./优化建议汇总.md) 中的创新点
3. 使用功能优先级矩阵决定开发顺序
4. 设计关卡布局和敌人配置

#### 📊 **制作人/项目经理**
1. 查看 [开发路线图](./开发路线图.md) 了解时间线
2. 评估资源需求与成本
3. 使用风险管理策略规避常见问题
4. 按阶段里程碑追踪进度

---

## 🚀 开发阶段概览

### 阶段1：原型验证（Week 1-4）
**目标**：验证核心玩法是否有趣

**关键任务**：
- [x] 技术选型和项目搭建
- [ ] 基础移动和相机
- [ ] 简单迷雾效果
- [ ] 1个魔法 + 1个敌人
- [ ] 5分钟可玩Demo

**验证点**：核心循环好玩吗？

---

### 阶段2：MVP开发（Month 1-3）
**目标**：完成1-2小时可玩内容

**关键系统**：
- [ ] 完整战斗系统（4个魔法，5种敌人）
- [ ] 第一个完整区域
- [ ] 等级和技能树
- [ ] 村庄基础功能
- [ ] 简单主线故事

**验证点**：玩家愿意继续玩吗？

---

### 阶段3：内容填充（Month 4-7）
**目标**：完成完整游戏体验

**关键内容**：
- [ ] 5个完整区域
- [ ] 完整技能树（4个流派）
- [ ] 主线+支线故事
- [ ] 所有核心系统优化
- [ ] 最终BOSS战

**验证点**：游戏体验完整吗？

---

### 阶段4：打磨发布（Month 8-10）
**目标**：达到可发布质量

**关键任务**：
- [ ] 数值平衡调整
- [ ] BUG修复
- [ ] 性能优化
- [ ] 玩家测试（20-50人）
- [ ] 宣传素材准备

**验证点**：可以自信地发布吗？

---

## 📈 成功指标

### 核心体验指标
- ✅ 玩家能在**5分钟内**理解核心玩法
- ✅ 首日留存率 **>40%**
- ✅ 平均游戏时长 **>5小时**
- ✅ 主线完成率 **>30%**

### 发布目标
- 🎯 Steam好评率 **>75%**（理想 >80%）
- 🎯 销量 **1-5万份**（独立游戏标准）
- 🎯 玩家评价关键词："探索有趣"、"故事感人"、"魔法系统有深度"

---

## 🎨 视觉风格预览

### 色彩情绪
- **安全区**：温暖的绿、黄、棕色调 🏡
- **迷雾区**：神秘的灰、紫色调 🌫️
- **魔法**：鲜艳的红、蓝、紫、绿 ✨

### 核心美学
- **像素规格**：16x16 或 32x32
- **动画风格**：4-8帧流畅动画
- **氛围**：温暖但神秘，复古但现代

### 参考游戏
- Hyper Light Drifter（氛围）
- Celeste（动画）
- Dead Cells（战斗）
- Stardew Valley（温馨感）

---

## 💡 核心创新点

### 1. 智能迷雾系统 🌫️
迷雾不只是视觉效果，而是会"思考"的敌对系统
- 学习玩家行为
- 动态反扑
- 定期潮汐事件

### 2. 魔法融合战斗 ⚗️
不是单纯按技能，而是创造组合
- 火+冰=蒸汽爆炸
- 雷+水=导电水域
- 发现隐藏配方的乐趣

### 3. 可玩记忆片段 📜
故事不是"读"出来的，而是"玩"出来的
- 进入梦境体验过去
- 情感场景触发
- 完整拼凑真相

### 4. 动态村庄 🏘️
村庄随玩家推进而"活"起来
- 建筑修复
- NPC故事线
- 防御战玩法

### 5. 生态恢复 🌱
净化区域后世界真正"改变"
- 植物生长
- 友好生物出现
- 视觉满足感

---

## 📋 开发检查清单

### 启动前准备
- [ ] 确定团队分工
- [ ] 选择游戏引擎
- [ ] 准备美术资源（或找美术合作）
- [ ] 搭建版本控制（Git）
- [ ] 创建项目管理看板（Trello/Notion）

### 每周检查
- [ ] 做一个可玩构建
- [ ] 记录进度和遇到的问题
- [ ] 更新任务看板
- [ ] 备份项目文件

### 每月检查
- [ ] 邀请朋友测试
- [ ] 收集反馈并调整
- [ ] 评估进度是否符合预期
- [ ] 更新开发日志（用于未来宣传）

---

## 🔗 相关资源

### 学习资源
- **像素艺术**：[Lospec](https://lospec.com/)（调色板和教程）
- **游戏设计**：[Game Maker's Toolkit](https://www.youtube.com/c/MarkBrownGMT)
- **独立游戏**：[Derek Yu's Boss Fight Books](https://bossfightbooks.com/)

### 工具推荐
- **像素绘图**：[Aseprite](https://www.aseprite.org/)
- **音效**：[Freesound](https://freesound.org/)
- **音乐**：[OpenGameArt](https://opengameart.org/)

### 社区
- **Discord**：Pixel Art、Indie Game Devs
- **Reddit**：r/PixelArt、r/IndieDev、r/gamedev
- **Twitter**：#indiegame、#pixelart

---

## 🤝 贡献与反馈

### 当前状态
📌 **阶段**：设计文档完成，等待技术架构设计

### 下一步
1. 确定技术栈（引擎选择）
2. 搭建基础项目框架
3. 开始原型开发

### 联系方式
如有疑问或建议，欢迎联系项目负责人。

---

## 📜 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-10-15 | 初始设计文档完成 |

---

## 📄 文档许可

本文档仅供项目开发使用，未经授权不得外传。

---

**"在迷雾中，每一步都是勇气；在黑暗中，每一光都是希望。"**

🌟 让我们创造一个难忘的像素魔法世界！

