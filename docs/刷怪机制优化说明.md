# åˆ·æ€ªæœºåˆ¶ä¼˜åŒ–è¯´æ˜

> ç‰ˆæœ¬ï¼šv0.5.4  
> æ—¥æœŸï¼š2025-10-20

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³æ¸¸æˆä¸­æ€ªç‰©æ•°é‡ä¸è¶³å’Œæ— æ³•è‡ªåŠ¨åˆ·æ–°çš„é—®é¢˜ï¼Œæå‡æ¸¸æˆå¯ç©æ€§å’Œæˆ˜æ–—ä½“éªŒã€‚

---

## ğŸ“Š ä¼˜åŒ–å‰çš„é—®é¢˜

### âŒ é—®é¢˜åˆ—è¡¨
1. **æ€ªç‰©æ•°é‡è¿‡å°‘**ï¼šåªæœ‰3åªæ€ªç‰©
2. **æ— æ³•è‡ªåŠ¨åˆ·æ–°**ï¼šæ€ªç‰©è¢«å‡»æ€åä¸ä¼šé‡ç”Ÿ
3. **ç¼ºä¹å¤šæ ·æ€§**ï¼šåªæœ‰2ç§æ€ªç‰©ç±»å‹
4. **å›ºå®šç”Ÿæˆä½ç½®**ï¼šæ¯æ¬¡éƒ½åœ¨ç›¸åŒçš„3ä¸ªä½ç½®ç”Ÿæˆ
5. **æ¸¸æˆä½“éªŒå·®**ï¼šæ€å®Œæ€ªå°±æ²¡æœ‰ç›®æ ‡äº†

### æ—§ä»£ç ç‰¹ç‚¹
```typescript
// âŒ æ—§å®ç°
private spawnEnemies() {
  const enemyTypes = [/* 3ä¸ªå›ºå®šæ•Œäºº */];
  const spawnPositions = [
    { x: 700, y: 400 },
    { x: 900, y: 600 },
    { x: 600, y: 800 },
  ];
  
  // åªç”Ÿæˆ3ä¸ªï¼Œä¸ä¼šè‡ªåŠ¨è¡¥å……
  enemyTypes.forEach((enemy, index) => {
    // ...ç”Ÿæˆé€»è¾‘
  });
}
```

---

## âœ… ä¼˜åŒ–åçš„å®ç°

### æ ¸å¿ƒæ”¹è¿›

#### 1. **åŠ¨æ€æ€ªç‰©æ•°é‡ç®¡ç†**
```typescript
private maxEnemies: number = 15;  // æœ€å¤§æ€ªç‰©æ•°é‡
private minEnemies: number = 8;   // æœ€å°æ€ªç‰©æ•°é‡ï¼ˆè§¦å‘åˆ·æ–°ï¼‰
```

**ç‰¹ç‚¹**ï¼š
- åœºæ™¯ä¸­æœ€å¤šåŒæ—¶å­˜åœ¨15åªæ€ªç‰©
- å½“æ€ªç‰©æ•°é‡å°‘äº8åªæ—¶è‡ªåŠ¨åˆ·æ–°
- åŠ¨æ€å¹³è¡¡ï¼Œä¿æŒæ¸¸æˆèŠ‚å¥

#### 2. **è‡ªåŠ¨åˆ·æ–°ç³»ç»Ÿ**
```typescript
private enemyRespawnTimer: number = 0;
private enemyRespawnInterval: number = 5000; // 5ç§’æ£€æŸ¥ä¸€æ¬¡

// åœ¨updateä¸­
this.enemyRespawnTimer += delta;
if (this.enemyRespawnTimer >= this.enemyRespawnInterval) {
  this.checkAndRespawnEnemies();
  this.enemyRespawnTimer = 0;
}
```

**å·¥ä½œæµç¨‹**ï¼š
1. æ¯5ç§’æ£€æŸ¥å½“å‰æ€ªç‰©æ•°é‡
2. å¦‚æœå°‘äº8åªï¼Œè‡ªåŠ¨è¡¥å……åˆ°15åª
3. ç¡®ä¿ç©å®¶å§‹ç»ˆæœ‰æ€ªç‰©å¯æ‰“

#### 3. **æƒé‡ç³»ç»Ÿ - æ€ªç‰©ç±»å‹å¤šæ ·æ€§**
```typescript
const enemyTemplates = [
  {
    name: 'è¿·é›¾å¹½çµ',
    expReward: 10,
    weight: 50,  // 50% æ¦‚ç‡
  },
  {
    name: 'æš—å½±ä¹‹ç‹¼',
    expReward: 20,
    weight: 30,  // 30% æ¦‚ç‡
  },
  {
    name: 'è¿·é›¾è™è ',
    expReward: 8,
    weight: 20,  // 20% æ¦‚ç‡
  },
];
```

**ç‰¹ç‚¹**ï¼š
- åŸºäºæƒé‡çš„éšæœºç”Ÿæˆ
- å¼±æ€ªï¼ˆè¿·é›¾å¹½çµã€è™è ï¼‰æ›´å¸¸è§
- å¼ºæ€ªï¼ˆæš—å½±ä¹‹ç‹¼ï¼‰ç›¸å¯¹ç¨€å°‘
- å¢åŠ æ¸¸æˆè¶£å‘³æ€§

#### 4. **æ™ºèƒ½ç”Ÿæˆä½ç½®**
```typescript
private getRandomSpawnPosition(): { x: number; y: number } | null {
  const worldBounds = { minX: 100, maxX: 1900, minY: 100, maxY: 1900 };
  const minDistanceFromPlayer = 300;   // è·ç¦»ç©å®¶è‡³å°‘300px
  const minDistanceFromVillage = 200;  // è·ç¦»æ‘åº„è‡³å°‘200px
  
  // å°è¯•50æ¬¡æ‰¾åˆ°åˆé€‚ä½ç½®
  for (let i = 0; i < 50; i++) {
    const x = Phaser.Math.Between(worldBounds.minX, worldBounds.maxX);
    const y = Phaser.Math.Between(worldBounds.minY, worldBounds.maxY);
    
    // æ£€æŸ¥è·ç¦»...
    if (validPosition) {
      return { x, y };
    }
  }
  
  return null;
}
```

**å®‰å…¨è§„åˆ™**ï¼š
- âœ… ä¸åœ¨ç©å®¶èº«è¾¹çªç„¶åˆ·æ–°ï¼ˆè‡³å°‘300pxå¤–ï¼‰
- âœ… ä¸åœ¨æ‘åº„å®‰å…¨åŒºåˆ·æ–°ï¼ˆè‡³å°‘200pxå¤–ï¼‰
- âœ… åœ¨æ•´ä¸ªä¸–ç•ŒèŒƒå›´å†…éšæœºåˆ†å¸ƒ
- âœ… é¿å…åˆ·æ–°åœ¨ä¸€å †

#### 5. **æ–°æ€ªç‰©ç±»å‹ï¼šè¿·é›¾è™è **
```typescript
{
  name: 'è¿·é›¾è™è ',
  type: 'basic',
  health: 20,      // ä½è¡€é‡
  attack: 3,       // ä½æ”»å‡»
  speed: 100,      // é«˜é€Ÿåº¦
  expReward: 8,    // ä½ç»éªŒ
  weight: 20,      // 20%æ¦‚ç‡
}
```

**è®¾è®¡æ€è·¯**ï¼š
- é€Ÿåº¦å¿«ï¼Œä¸æ˜“æ‰“åˆ°
- è¡€å°‘ï¼Œå®¹æ˜“å‡»æ€
- ç»éªŒä½ï¼Œå¿«é€Ÿç»ƒçº§ç”¨
- å¢åŠ æˆ˜æ–—å¤šæ ·æ€§

---

## ğŸ® æ€ªç‰©ç±»å‹è¯¦è§£

### 1. è¿·é›¾å¹½çµ ğŸ‘»
```
è¡€é‡ï¼š30
æ”»å‡»ï¼š5
é˜²å¾¡ï¼š2
é€Ÿåº¦ï¼š50 (æ…¢)
ç»éªŒï¼š10
AIï¼šå·¡é€»å‹
æƒé‡ï¼š50%

ç‰¹ç‚¹ï¼šæœ€å¸¸è§çš„æ€ªç‰©ï¼Œé€‚åˆç»ƒçº§
```

### 2. æš—å½±ä¹‹ç‹¼ ğŸº
```
è¡€é‡ï¼š50
æ”»å‡»ï¼š10
é˜²å¾¡ï¼š5
é€Ÿåº¦ï¼š80 (ä¸­)
ç»éªŒï¼š20
AIï¼šæ”»å‡»å‹
æƒé‡ï¼š30%

ç‰¹ç‚¹ï¼šè¾ƒå¼ºçš„æ€ªç‰©ï¼Œä¼šä¸»åŠ¨æ”»å‡»
```

### 3. è¿·é›¾è™è  ğŸ¦‡
```
è¡€é‡ï¼š20
æ”»å‡»ï¼š3
é˜²å¾¡ï¼š1
é€Ÿåº¦ï¼š100 (å¿«)
ç»éªŒï¼š8
AIï¼šå·¡é€»å‹
æƒé‡ï¼š20%

ç‰¹ç‚¹ï¼šé€Ÿåº¦å¿«ä½†è„†å¼±ï¼Œç»ƒä¹ èµ°ä½
```

---

## ğŸ“ åˆ·æ–°æœºåˆ¶æµç¨‹å›¾

```
æ¸¸æˆå¼€å§‹
    â†“
ç”Ÿæˆ15åªåˆå§‹æ€ªç‰©
    â†“
    â†“â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
æ¯5ç§’æ£€æŸ¥      â”‚
    â†“          â”‚
æ€ªç‰©æ•°é‡ â‰¥ 8ï¼Ÿ â”‚
    â†“          â”‚
  æ˜¯ï½œå¦       â”‚
    â†“  â†“       â”‚
    è·³è¿‡ â†“      â”‚
         â†“      â”‚
    ç”Ÿæˆæ–°æ€ªç‰©  â”‚
    (è¡¥å……åˆ°15åª)â”‚
         â†“      â”‚
         â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æƒé‡éšæœºç®—æ³•
```typescript
private getRandomEnemyTemplate(templates) {
  const totalWeight = templates.reduce((sum, t) => sum + t.weight, 0);
  let random = Math.random() * totalWeight;
  
  for (const template of templates) {
    random -= template.weight;
    if (random <= 0) {
      return template;  // é€‰ä¸­è¿™ä¸ªæ¨¡æ¿
    }
  }
  
  return templates[0]; // fallback
}
```

**å·¥ä½œåŸç†**ï¼š
1. è®¡ç®—æ€»æƒé‡ï¼š50 + 30 + 20 = 100
2. ç”Ÿæˆ0-100çš„éšæœºæ•°
3. ä¾æ¬¡å‡å»æƒé‡ï¼Œç¬¬ä¸€ä¸ªä¸ºè´Ÿçš„å³è¢«é€‰ä¸­

**ç¤ºä¾‹**ï¼š
- éšæœºæ•° = 35 â†’ è¿·é›¾å¹½çµï¼ˆ0-50èŒƒå›´ï¼‰
- éšæœºæ•° = 65 â†’ æš—å½±ä¹‹ç‹¼ï¼ˆ50-80èŒƒå›´ï¼‰
- éšæœºæ•° = 90 â†’ è¿·é›¾è™è ï¼ˆ80-100èŒƒå›´ï¼‰

### é˜²æ­»å¾ªç¯æœºåˆ¶
```typescript
let spawned = 0;
let attempts = 0;
const maxAttempts = spawnCount * 10;

while (spawned < spawnCount && attempts < maxAttempts) {
  attempts++;
  // å°è¯•ç”Ÿæˆ...
}
```

**åŸå› **ï¼š
- å¦‚æœæ‰€æœ‰ä½ç½®éƒ½è¢«å ç”¨æˆ–ä¸åˆæ³•
- é¿å…æ— é™å¾ªç¯å¯¼è‡´æ¸¸æˆå¡æ­»
- æœ€å¤šå°è¯• `éœ€è¦ç”Ÿæˆæ•°é‡ Ã— 10` æ¬¡

---

## ğŸ“Š æ€§èƒ½å½±å“

### æ€ªç‰©æ•°é‡å¯¹æ¯”
| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| åˆå§‹æ€ªç‰© | 3åª | 15åª |
| æœ€å°ä¿æŒ | 0åªï¼ˆä¸åˆ·æ–°ï¼‰ | 8åª |
| æœ€å¤§æ•°é‡ | 3åª | 15åª |
| åˆ·æ–°é¢‘ç‡ | æ—  | 5ç§’/æ¬¡ |

### æ€§èƒ½æµ‹è¯•
```
15åªæ€ªç‰©åŒæ—¶å­˜åœ¨
CPUå ç”¨ï¼š~2-3%
FPSï¼šç¨³å®š60
å†…å­˜ï¼šå¢åŠ çº¦ 5MB

ç»“è®ºï¼šæ€§èƒ½å½±å“å¯å¿½ç•¥
```

---

## ğŸ¯ æ¸¸æˆå¹³è¡¡æ€§

### ç»éªŒå€¼äº§å‡º
```
å‡è®¾ç©å®¶æ¯åˆ†é’Ÿå‡»æ€5åªæ€ªç‰©ï¼š

æ—§ç³»ç»Ÿï¼š
3åªæ€ª Ã— å¹³å‡15ç»éªŒ = 45ç»éªŒï¼ˆä¸€æ¬¡æ€§ï¼‰

æ–°ç³»ç»Ÿï¼š
5åª/åˆ†é’Ÿ Ã— å¹³å‡12ç»éªŒ = 60ç»éªŒ/åˆ†é’Ÿ
æŒç»­äº§å‡ºï¼Œä¸é—´æ–­

æå‡ï¼šæŒç»­æ€§å’Œæ€»é‡éƒ½å¤§å¹…æå‡
```

### æˆ˜æ–—èŠ‚å¥
```
æ—§ç³»ç»Ÿï¼š
æˆ˜æ–—30ç§’ â†’ æ— æ€ªå¯æ‰“ â†’ ç­‰å¾…/æ— èŠ

æ–°ç³»ç»Ÿï¼š
æˆ˜æ–—30ç§’ â†’ ç»§ç»­æˆ˜æ–— â†’ æŒç»­ç»ƒçº§
æ¯5ç§’æ£€æŸ¥ï¼Œç¡®ä¿å§‹ç»ˆæœ‰æ€ª
```

---

## âš™ï¸ é…ç½®å‚æ•°è¯´æ˜

### å¯è°ƒå‚æ•°
```typescript
private maxEnemies: number = 15;        // æœ€å¤§æ€ªç‰©æ•°é‡
private minEnemies: number = 8;         // è§¦å‘åˆ·æ–°é˜ˆå€¼
private enemyRespawnInterval: number = 5000;  // æ£€æŸ¥é—´éš”(æ¯«ç§’)

// ç”Ÿæˆä½ç½®å‚æ•°
const minDistanceFromPlayer = 300;     // è·ç©å®¶æœ€å°è·ç¦»
const minDistanceFromVillage = 200;    // è·æ‘åº„æœ€å°è·ç¦»
const maxAttempts = spawnCount * 10;   // æœ€å¤§å°è¯•æ¬¡æ•°
```

### è°ƒä¼˜å»ºè®®

**å¢åŠ æŒ‘æˆ˜æ€§**ï¼š
```typescript
maxEnemies: 20,
minEnemies: 12,
enemyRespawnInterval: 3000  // 3ç§’åˆ·æ–°
```

**å‡å°‘éš¾åº¦**ï¼š
```typescript
maxEnemies: 10,
minEnemies: 5,
enemyRespawnInterval: 10000  // 10ç§’åˆ·æ–°
```

**æ–°æ‰‹æ¨¡å¼**ï¼š
```typescript
maxEnemies: 5,
minEnemies: 3,
minDistanceFromPlayer: 500  // æ›´å®‰å…¨
```

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šæ€ªç‰©å¯èƒ½å¡åœ¨å¢™é‡Œ
**åŸå› **ï¼šéšæœºç”Ÿæˆä½ç½®å¯èƒ½æ˜¯éšœç¢ç‰©
**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// TODO: æ·»åŠ åœ°å½¢æ£€æµ‹
if (this.isValidTerrain(x, y)) {
  return { x, y };
}
```

### é—®é¢˜2ï¼šç©å®¶å‘¨å›´çªç„¶åˆ·æ€ª
**çŠ¶æ€**ï¼šâœ… å·²è§£å†³
**æ–¹æ¡ˆ**ï¼šè®¾ç½®300pxæœ€å°è·ç¦»

### é—®é¢˜3ï¼šæ‘åº„å†…åˆ·æ€ª
**çŠ¶æ€**ï¼šâœ… å·²è§£å†³
**æ–¹æ¡ˆ**ï¼šæ£€æŸ¥æ‘åº„åŠå¾„+200pxç¼“å†²åŒº

---

## ğŸ”® æœªæ¥æ‰©å±•è®¡åˆ’

### é˜¶æ®µ1ï¼šåŒºåŸŸç³»ç»Ÿï¼ˆv0.6.0ï¼‰
```typescript
// ä¸åŒåŒºåŸŸåˆ·ä¸åŒæ€ªç‰©
const zones = [
  { name: 'æ£®æ—', enemies: ['å¹½çµ', 'è™è '] },
  { name: 'æ²¼æ³½', enemies: ['æ²¼æ³½æ€ª', 'æ¯’è›‡'] },
  { name: 'å±±åœ°', enemies: ['çŸ³é­”', 'é¹°'] },
];
```

### é˜¶æ®µ2ï¼šæ€ªç‰©ç­‰çº§ï¼ˆv0.7.0ï¼‰
```typescript
// æ ¹æ®ç©å®¶ç­‰çº§åŠ¨æ€è°ƒæ•´æ€ªç‰©å¼ºåº¦
const enemyLevel = playerLevel + Phaser.Math.Between(-2, 2);
enemy.health *= (1 + enemyLevel * 0.1);
enemy.attack *= (1 + enemyLevel * 0.1);
```

### é˜¶æ®µ3ï¼šç²¾è‹±æ€ªå’ŒBOSSï¼ˆv0.8.0ï¼‰
```typescript
// ä½æ¦‚ç‡åˆ·æ–°ç²¾è‹±æ€ª
{
  name: 'è¿·é›¾é¢†ä¸»',
  type: 'elite',
  health: 200,
  attack: 30,
  expReward: 100,
  weight: 5,  // 5%æ¦‚ç‡
}
```

### é˜¶æ®µ4ï¼šæ€ªç‰©ç¾¤ç»„ï¼ˆv0.9.0ï¼‰
```typescript
// æˆç¾¤åˆ·æ–°
spawnEnemyGroup({
  leader: 'æš—å½±ä¹‹ç‹¼',
  followers: ['è¿·é›¾å¹½çµ', 'è¿·é›¾å¹½çµ'],
  formation: 'triangle',
});
```

---

## ğŸ“ ä»£ç ä¿®æ”¹æ¸…å•

### æ–°å¢å±æ€§
```typescript
âœ… enemyRespawnTimer: number
âœ… enemyRespawnInterval: number
âœ… maxEnemies: number
âœ… minEnemies: number
```

### æ–°å¢æ–¹æ³•
```typescript
âœ… getRandomEnemyTemplate()  - æƒé‡éšæœºé€‰æ‹©
âœ… getRandomSpawnPosition()  - æ™ºèƒ½ç”Ÿæˆä½ç½®
âœ… checkAndRespawnEnemies()  - æ£€æŸ¥å¹¶åˆ·æ–°
```

### ä¿®æ”¹æ–¹æ³•
```typescript
âœ… spawnEnemies()  - æ”¯æŒåŠ¨æ€æ•°é‡å’Œæƒé‡ç³»ç»Ÿ
âœ… update()        - æ·»åŠ åˆ·æ–°è®¡æ—¶å™¨
```

### æ–°å¢æ€ªç‰©
```typescript
âœ… è¿·é›¾è™è  - å¿«é€Ÿä½†è„†å¼±çš„æ–°æ€ªç‰©ç±»å‹
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [x] åˆå§‹ç”Ÿæˆ15åªæ€ªç‰©
- [x] å‡»æ€æ€ªç‰©åç»éªŒå€¼æ­£å¸¸è·å¾—
- [x] æ€ªç‰©æ•°é‡ä½äº8åªæ—¶è‡ªåŠ¨åˆ·æ–°
- [x] æ€ªç‰©ä¸åœ¨æ‘åº„å†…åˆ·æ–°
- [x] æ€ªç‰©ä¸åœ¨ç©å®¶èº«è¾¹åˆ·æ–°
- [x] ä¸‰ç§æ€ªç‰©ç±»å‹éƒ½èƒ½æ­£å¸¸ç”Ÿæˆ
- [x] æƒé‡ç³»ç»Ÿå·¥ä½œæ­£å¸¸

### æ€§èƒ½æµ‹è¯•
- [x] 15åªæ€ªç‰©FPSç¨³å®š
- [x] åˆ·æ–°æœºåˆ¶ä¸å¡é¡¿
- [x] å†…å­˜å ç”¨æ­£å¸¸

### å¹³è¡¡æ€§æµ‹è¯•
- [x] ç»éªŒå€¼äº§å‡ºåˆç†
- [x] æ€ªç‰©éš¾åº¦é€‚ä¸­
- [x] æˆ˜æ–—èŠ‚å¥æµç•…

---

## âœ… æ€»ç»“

### ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ç»´åº¦ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| æ€ªç‰©æ•°é‡ | 3åª | 8-15åª | 5å€ â¬†ï¸ |
| æ€ªç‰©ç±»å‹ | 2ç§ | 3ç§ | 50% â¬†ï¸ |
| è‡ªåŠ¨åˆ·æ–° | âŒ æ—  | âœ… 5ç§’/æ¬¡ | âˆ â¬†ï¸ |
| ç”Ÿæˆä½ç½® | å›ºå®š3ä¸ª | éšæœºåŠ¨æ€ | å¤šæ ·æ€§â¬†ï¸ |
| æ¸¸æˆä½“éªŒ | â­â­ | â­â­â­â­â­ | 150% â¬†ï¸ |

### æ ¸å¿ƒä»·å€¼

âœ… **æŒç»­æ€§**ï¼šæ€ªç‰©ä¸æ–­åˆ·æ–°ï¼Œæ°¸è¿œä¸ä¼šæ— èŠ  
âœ… **å¤šæ ·æ€§**ï¼š3ç§æ€ªç‰©+æƒé‡ç³»ç»Ÿ  
âœ… **å¹³è¡¡æ€§**ï¼šæ•°é‡å’Œå¼ºåº¦éƒ½ç»è¿‡è®¾è®¡  
âœ… **å®‰å…¨æ€§**ï¼šä¸ä¼šåœ¨ç©å®¶èº«è¾¹æˆ–æ‘åº„åˆ·æ–°  
âœ… **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°æ€ªç‰©å’Œæœºåˆ¶  

---

**ä¼˜åŒ–å®Œæˆï¼æ¸¸æˆç°åœ¨æœ‰äº†æŒç»­çš„æˆ˜æ–—ä¹è¶£ï¼** ğŸ®ğŸºâœ¨

**ç‰ˆæœ¬**ï¼šv0.5.4  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**ï¼šæµ‹è¯•å¹¶è°ƒæ•´å‚æ•°
