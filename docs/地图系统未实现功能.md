# 🗺️ 地图系统未实现功能清单

> 记录时间：2025-10-20  
> 当前版本：v0.3.3

---

## 📋 未实现功能列表

### 1. 路径规划功能 ⏳
**优先级**: P2 - 中等  
**工作量**: 5-8小时  
**难度**: 高

#### 功能描述
- 点击地图设置目标点
- A*寻路算法计算最优路径
- 在地图上显示路径线
- 玩家自动跟随路径移动
- 实时避开障碍物和敌人

#### 技术实现
```typescript
// A*算法核心
interface Node {
  x: number;
  y: number;
  g: number; // 起点到当前点的距离
  h: number; // 当前点到终点的估算距离
  f: number; // g + h
  parent: Node | null;
}

function astar(start: Point, end: Point, obstacles: Point[]): Point[] {
  // 实现A*算法
}
```

#### 用户价值
- 自动导航到目标地点
- 减少手动操作
- 提升游戏体验

#### 设计建议
- 路径线使用虚线显示
- 颜色：黄色或绿色
- 可以取消路径规划
- 实时重新计算路径（遇到障碍）

---

### 2. 历史轨迹记录 ⏳
**优先级**: P2 - 中等  
**工作量**: 2-3小时  
**难度**: 中

#### 功能描述
- 记录玩家移动轨迹
- 在地图上显示移动路线
- 可以回放历史轨迹
- 轨迹淡化效果（越旧越淡）

#### 技术实现
```typescript
interface TrajectoryPoint {
  x: number;
  y: number;
  timestamp: number;
}

const trajectory: TrajectoryPoint[] = [];

// 每秒记录一次位置
setInterval(() => {
  trajectory.push({
    x: playerPosition.x,
    y: playerPosition.y,
    timestamp: Date.now(),
  });
}, 1000);

// 只保留最近1000个点
if (trajectory.length > 1000) {
  trajectory.shift();
}
```

#### 用户价值
- 查看探索历史
- 避免重复探索
- 发现遗漏区域

#### 设计建议
- 使用半透明线条
- 颜色：白色或浅蓝色
- 可以清除历史轨迹
- 可以导出轨迹数据

---

### 3. 地图标注系统 ⏳
**优先级**: P3 - 低  
**工作量**: 3-4小时  
**难度**: 中

#### 功能描述
- 玩家可以在地图上添加自定义标记
- 支持多种标记类型：
  - 📍 重要位置
  - ⚠️ 危险区域
  - 💎 宝藏位置
  - 📝 自定义备注
- 标记可以编辑和删除

#### 技术实现
```typescript
interface MapMarker {
  id: string;
  x: number;
  y: number;
  type: 'important' | 'danger' | 'treasure' | 'note';
  label: string;
  icon: string;
  color: string;
  createdAt: number;
}

const customMarkers: MapMarker[] = [];

// 添加标记
function addMarker(x: number, y: number, type: string, label: string) {
  customMarkers.push({
    id: generateId(),
    x, y, type, label,
    icon: getIconByType(type),
    color: getColorByType(type),
    createdAt: Date.now(),
  });
}
```

#### 用户价值
- 个性化地图
- 记录重要位置
- 团队协作标记

#### 设计建议
- 右键点击地图添加标记
- 弹出标记编辑面板
- 支持拖拽移动标记
- 标记数量限制：100个

---

### 4. 小地图自定义位置 ⏳
**优先级**: P3 - 低  
**工作量**: 1小时  
**难度**: 低

#### 功能描述
- 小地图可以拖拽到任意位置
- 预设位置：
  - 右上角（默认）
  - 左上角
  - 右下角
  - 左下角
- 记住用户选择

#### 技术实现
```typescript
const [miniMapPosition, setMiniMapPosition] = useState<
  'top-right' | 'top-left' | 'bottom-right' | 'bottom-left'
>('top-right');

// 保存到LocalStorage
localStorage.setItem('miniMapPosition', miniMapPosition);
```

#### 用户价值
- 适应不同游戏习惯
- 避免遮挡游戏内容
- 提升可访问性

#### 设计建议
- 设置面板中选择位置
- 支持拖拽自由移动
- 半透明度可调节

---

### 5. 地图分享功能 ⏳
**优先级**: P3 - 低  
**工作量**: 2-3小时  
**难度**: 中

#### 功能描述
- 导出当前地图为图片
- 分享到社交媒体
- 生成地图分享链接
- 显示探索进度统计

#### 技术实现
```typescript
// 导出地图为图片
function exportMapAsImage() {
  const canvas = canvasRef.current;
  const dataURL = canvas.toDataURL('image/png');
  
  // 下载图片
  const link = document.createElement('a');
  link.download = `map-${Date.now()}.png`;
  link.href = dataURL;
  link.click();
}

// 生成分享数据
const shareData = {
  exploredAreas: progress.exploredAreas.length,
  totalAreas: 625, // 25x25
  explorationRate: (progress.exploredAreas.length / 625) * 100,
  playTime: getPlayTime(),
};
```

#### 用户价值
- 展示探索成就
- 社交分享
- 激励其他玩家

#### 设计建议
- 导出高清图片
- 添加水印和统计信息
- 一键分享按钮
- 支持多种社交平台

---

## 📊 功能优先级矩阵

| 功能 | 优先级 | 工作量 | 用户价值 | 技术难度 | 建议实施时间 |
|------|--------|--------|---------|---------|-------------|
| 路径规划 | P2 | 5-8h | 高 | 高 | v0.4.0 |
| 历史轨迹 | P2 | 2-3h | 中 | 中 | v0.4.0 |
| 地图标注 | P3 | 3-4h | 中 | 中 | v0.5.0 |
| 自定义位置 | P3 | 1h | 低 | 低 | v0.5.0 |
| 地图分享 | P3 | 2-3h | 低 | 中 | v0.5.0 |

---

## 🎯 实施建议

### 短期（v0.4.0）
建议优先实现：
1. **路径规划功能** - 提升用户体验
2. **历史轨迹记录** - 辅助探索

**原因**：
- 这两个功能用户价值高
- 可以显著提升游戏体验
- 技术实现相对独立

### 中期（v0.5.0）
考虑实现：
1. **地图标注系统** - 个性化体验
2. **小地图自定义** - 用户偏好设置

**原因**：
- 锦上添花的功能
- 不影响核心玩法
- 可以增加游戏深度

### 长期（v0.6.0+）
可选实现：
1. **地图分享功能** - 社交元素

**原因**：
- 需要社交系统支持
- 优先级较低
- 可以考虑与成就系统结合

---

## 💡 技术难点

### 1. 路径规划
- **难点**: A*算法实现和优化
- **解决方案**: 
  - 使用成熟的A*库（如pathfinding.js）
  - 预计算导航网格
  - 异步计算路径避免卡顿

### 2. 历史轨迹
- **难点**: 性能优化（大量轨迹点）
- **解决方案**:
  - 轨迹点数量限制
  - 使用简化算法（Douglas-Peucker）
  - 定期清理旧数据

### 3. 地图标注
- **难点**: UI交互复杂度
- **解决方案**:
  - 使用成熟的地图标注库
  - 分离标注逻辑和渲染逻辑
  - 提供清晰的用户引导

---

## 📝 开发建议

### 开发顺序
```
1. 路径规划（核心功能）
   ↓
2. 历史轨迹（数据收集）
   ↓
3. 地图标注（扩展功能）
   ↓
4. 自定义位置（UI优化）
   ↓
5. 地图分享（社交功能）
```

### 测试要点
- 路径规划：测试各种障碍场景
- 历史轨迹：测试性能和内存占用
- 地图标注：测试标记上限和性能
- 自定义位置：测试所有布局位置
- 地图分享：测试导出质量和兼容性

### 性能目标
- 路径计算：< 100ms
- 轨迹渲染：60fps
- 标注上限：100个
- 导出时间：< 2s

---

## 🔗 相关文档

- [地图系统增强说明](./地图系统增强说明.md)
- [已完成功能总结](./已完成功能总结.md)
- [技术架构文档](./技术架构文档.md)

---

**持续更新中...** 📝✨

**版本**: v1.0  
**创建时间**: 2025-10-20  
**维护者**: 项目团队
