# ğŸ’¾ æ•°æ®æŒä¹…åŒ–è¯´æ˜

> **å®ç°æ—¶é—´**: 2025-10-20  
> **å­˜å‚¨æ–¹å¼**: LocalStorage  
> **å­˜å‚¨ä½ç½®**: æµè§ˆå™¨æœ¬åœ°å­˜å‚¨

---

## ğŸ“¦ æ•°æ®å­˜å‚¨ä½ç½®

### æµè§ˆå™¨ LocalStorage
æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨çš„ **LocalStorage** ä¸­ï¼Œè·¯å¾„å¦‚ä¸‹ï¼š

```
æµè§ˆå™¨ -> å¼€å‘è€…å·¥å…· (F12) -> Application -> Local Storage -> http://localhost:5173
```

**å­˜å‚¨é”®å**: `forgotten-realm-storage`

---

## ğŸ“Š å­˜å‚¨çš„æ•°æ®å†…å®¹

### âœ… ä¼šè¢«æŒä¹…åŒ–çš„æ•°æ®

#### 1. ç©å®¶æ•°æ® (player)
```typescript
{
  level: number;           // ç©å®¶ç­‰çº§
  exp: number;             // å½“å‰ç»éªŒå€¼
  expToNextLevel: number;  // å‡çº§æ‰€éœ€ç»éªŒ
  health: number;          // å½“å‰ç”Ÿå‘½å€¼
  maxHealth: number;       // æœ€å¤§ç”Ÿå‘½å€¼
  mana: number;            // å½“å‰é­”åŠ›å€¼
  maxMana: number;         // æœ€å¤§é­”åŠ›å€¼
  attack: number;          // æ”»å‡»åŠ›
  defense: number;         // é˜²å¾¡åŠ›
  speed: number;           // ç§»åŠ¨é€Ÿåº¦
  skills: string[];        // å·²å­¦ä¹ çš„æŠ€èƒ½IDåˆ—è¡¨
  equippedItems: {         // è£…å¤‡çš„ç‰©å“
    weapon?: Item;
    armor?: Item;
    accessory?: Item;
  };
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "level": 1,
  "exp": 0,
  "expToNextLevel": 100,
  "health": 100,
  "maxHealth": 100,
  "mana": 80,
  "maxMana": 80,
  "attack": 10,
  "defense": 5,
  "speed": 100,
  "skills": ["fireball"],
  "equippedItems": {}
}
```

---

#### 2. ç©å®¶ä½ç½® (playerPosition) â­ æ ¸å¿ƒ
```typescript
{
  x: number;  // ä¸–ç•Œåæ ‡ X (0-2000)
  y: number;  // ä¸–ç•Œåæ ‡ Y (0-2000)
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "x": 400,
  "y": 300
}
```

**ä½œç”¨**: 
- ä¸‹æ¬¡è¿›å…¥æ¸¸æˆæ—¶ï¼Œç©å®¶ä¼šå‡ºç°åœ¨ä¸Šæ¬¡ç¦»å¼€çš„ä½ç½®
- é¿å…æ¯æ¬¡éƒ½ä»èµ·ç‚¹å¼€å§‹

---

#### 3. èƒŒåŒ…æ•°æ® (inventory)
```typescript
{
  items: (Item | null)[];  // 20ä¸ªç‰©å“æ§½ä½
  maxSlots: number;        // æœ€å¤§æ§½ä½æ•°
}
```

**Item ç»“æ„**ï¼š
```typescript
{
  id: string;           // ç‰©å“ID
  name: string;         // ç‰©å“åç§°
  description: string;  // ç‰©å“æè¿°
  type: string;         // ç±»å‹ï¼šweapon/armor/consumable/material/quest
  rarity: string;       // ç¨€æœ‰åº¦ï¼šcommon/uncommon/rare/epic/legendary
  stats?: object;       // å±æ€§åŠ æˆ
  stackable: boolean;   // æ˜¯å¦å¯å †å 
  maxStack: number;     // æœ€å¤§å †å æ•°é‡
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "items": [
    {
      "id": "health_potion",
      "name": "ç”Ÿå‘½è¯æ°´",
      "description": "æ¢å¤50ç‚¹ç”Ÿå‘½å€¼",
      "type": "consumable",
      "rarity": "common",
      "stackable": true,
      "maxStack": 99
    },
    null,
    null,
    // ... 18ä¸ªç©ºæ§½ä½
  ],
  "maxSlots": 20
}
```

---

#### 4. ä»»åŠ¡æ•°æ® (quests)
```typescript
Quest[] = {
  id: string;           // ä»»åŠ¡ID
  title: string;        // ä»»åŠ¡æ ‡é¢˜
  description: string;  // ä»»åŠ¡æè¿°
  type: string;         // ç±»å‹ï¼šmain/side/daily
  status: string;       // çŠ¶æ€ï¼šavailable/active/completed/failed
  objectives: [];       // ä»»åŠ¡ç›®æ ‡
  rewards: [];          // ä»»åŠ¡å¥–åŠ±
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
[
  {
    "id": "tutorial_quest",
    "title": "æ–°æ‰‹æŒ‡å¼•",
    "description": "æ¢ç´¢å‘¨å›´çš„ä¸–ç•Œ",
    "type": "main",
    "status": "active",
    "objectives": [
      {
        "id": "explore_5_areas",
        "description": "æ¢ç´¢5ä¸ªåŒºåŸŸ",
        "current": 3,
        "required": 5,
        "completed": false
      }
    ],
    "rewards": [
      {
        "type": "exp",
        "value": 100
      }
    ]
  }
]
```

---

#### 5. æ¸¸æˆè¿›åº¦ (progress) â­ æ ¸å¿ƒ
```typescript
{
  exploredAreas: string[];      // å·²æ¢ç´¢åŒºåŸŸåˆ—è¡¨ï¼ˆæœ€é‡è¦ï¼‰
  killedBosses: string[];       // å·²å‡»è´¥çš„Boss
  unlockedSkills: string[];     // å·²è§£é”çš„æŠ€èƒ½
  completedQuests: string[];    // å·²å®Œæˆçš„ä»»åŠ¡ID
  discoveredItems: string[];    // å·²å‘ç°çš„ç‰©å“ID
}
```

**exploredAreas æ ¼å¼**ï¼š`"tileX-tileY"`ï¼ˆ64åƒç´ ç½‘æ ¼åæ ‡ï¼‰

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "exploredAreas": [
    "6-4",   // åæ ‡ (384,256) çš„åŒºåŸŸ
    "6-5",   // åæ ‡ (384,320) çš„åŒºåŸŸ
    "7-4",   // åæ ‡ (448,256) çš„åŒºåŸŸ
    "7-5",
    // ... æ›´å¤šå·²æ¢ç´¢åŒºåŸŸ
  ],
  "killedBosses": [],
  "unlockedSkills": ["fireball"],
  "completedQuests": [],
  "discoveredItems": []
}
```

**æ¢ç´¢åŒºåŸŸè®¡ç®—**ï¼š
```javascript
// ç©å®¶ä½ç½® (400, 300)
const areaX = Math.floor(400 / 64); // = 6
const areaY = Math.floor(300 / 64); // = 4
const areaKey = "6-4";
```

---

#### 6. æ¸¸æˆè®¾ç½® (settings)
```typescript
{
  volume: {
    master: number;  // ä¸»éŸ³é‡ (0.0-1.0)
    music: number;   // éŸ³ä¹éŸ³é‡
    sfx: number;     // éŸ³æ•ˆéŸ³é‡
  };
  graphics: {
    fullscreen: boolean;  // å…¨å±æ¨¡å¼
    vsync: boolean;       // å‚ç›´åŒæ­¥
  };
  controls: {
    [key: string]: string;  // è‡ªå®šä¹‰æŒ‰é”®ç»‘å®š
  };
}
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "volume": {
    "master": 1.0,
    "music": 0.8,
    "sfx": 0.8
  },
  "graphics": {
    "fullscreen": false,
    "vsync": true
  },
  "controls": {}
}
```

---

### âŒ ä¸ä¼šè¢«æŒä¹…åŒ–çš„æ•°æ®

ä»¥ä¸‹æ•°æ®æ˜¯**ä¸´æ—¶çŠ¶æ€**ï¼Œæ¯æ¬¡å¯åŠ¨æ¸¸æˆæ—¶ä¼šé‡ç½®ï¼š

#### 1. æ¸¸æˆçŠ¶æ€
```typescript
{
  isPlaying: boolean;      // æ˜¯å¦æ­£åœ¨æ¸¸æˆï¼ˆæ¯æ¬¡éƒ½æ˜¯ falseï¼‰
  isPaused: boolean;       // æ˜¯å¦æš‚åœï¼ˆæ¯æ¬¡éƒ½æ˜¯ falseï¼‰
  currentScene: string;    // å½“å‰åœºæ™¯ï¼ˆæ¯æ¬¡éƒ½æ˜¯ 'menu'ï¼‰
}
```

**åŸå› **: æ¯æ¬¡å¯åŠ¨éƒ½åº”è¯¥å›åˆ°ä¸»èœå•ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›å…¥æ¸¸æˆ

---

#### 2. UI æ˜¾ç¤ºçŠ¶æ€
```typescript
{
  ui: {
    showInventory: boolean;   // èƒŒåŒ…æ˜¯å¦æ˜¾ç¤º
    showSkillTree: boolean;   // æŠ€èƒ½æ ‘æ˜¯å¦æ˜¾ç¤º
    showQuestLog: boolean;    // ä»»åŠ¡æ—¥å¿—æ˜¯å¦æ˜¾ç¤º
    showMap: boolean;         // åœ°å›¾æ˜¯å¦æ˜¾ç¤º
  }
}
```

**åŸå› **: UIçª—å£åº”è¯¥é»˜è®¤å…³é—­ï¼Œç”¨æˆ·æŒ‰é”®æ—¶å†æ‰“å¼€

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹å­˜å‚¨çš„æ•°æ®

### æ–¹æ³•1ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. å¯åŠ¨æ¸¸æˆ `npm run dev`
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Application** æ ‡ç­¾
4. å·¦ä¾§å±•å¼€ **Local Storage** â†’ `http://localhost:5173`
5. æ‰¾åˆ°é”®å `forgotten-realm-storage`
6. æŸ¥çœ‹ **Value** åˆ—çš„ JSON æ•°æ®

### æ–¹æ³•2ï¼šæ§åˆ¶å°å‘½ä»¤
åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
// è¯»å–æ•°æ®
console.log(JSON.parse(localStorage.getItem('forgotten-realm-storage')));

// æ¸…ç©ºæ•°æ®
localStorage.removeItem('forgotten-realm-storage');

// ä¿®æ”¹ç‰¹å®šæ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
const data = JSON.parse(localStorage.getItem('forgotten-realm-storage'));
data.state.player.level = 99;
localStorage.setItem('forgotten-realm-storage', JSON.stringify(data));
```

---

## ğŸ“ˆ æ•°æ®å¤§å°ä¼°ç®—

### åˆå§‹çŠ¶æ€
- **å¤§å°**: ~2 KB
- **åŒ…å«**: é»˜è®¤ç©å®¶æ•°æ®ã€ç©ºèƒŒåŒ…ã€åˆå§‹è®¾ç½®

### æ¸¸æˆ1å°æ—¶å
- **å¤§å°**: ~5-10 KB
- **åŒ…å«**: æ¢ç´¢100-200ä¸ªåŒºåŸŸã€è‹¥å¹²ç‰©å“ã€ä»»åŠ¡è¿›åº¦

### æ¸¸æˆ10å°æ—¶å
- **å¤§å°**: ~20-50 KB
- **åŒ…å«**: æ¢ç´¢500-1000ä¸ªåŒºåŸŸã€æ»¡èƒŒåŒ…ç‰©å“ã€å¤šä¸ªä»»åŠ¡

**æ³¨æ„**: LocalStorage ä¸Šé™é€šå¸¸æ˜¯ **5-10 MB**ï¼Œå®Œå…¨å¤Ÿç”¨

---

## ğŸ”„ æ•°æ®åŒæ­¥æœºåˆ¶

### è‡ªåŠ¨ä¿å­˜
- **è§¦å‘æ—¶æœº**: 
  - ç©å®¶ç§»åŠ¨åˆ°æ–°åŒºåŸŸæ—¶
  - è·å¾—ç‰©å“æ—¶
  - ä»»åŠ¡çŠ¶æ€æ”¹å˜æ—¶
  - è®¾ç½®ä¿®æ”¹æ—¶
  
- **ä¿å­˜æ–¹å¼**: 
  - Zustand è‡ªåŠ¨åŒæ­¥åˆ° LocalStorage
  - æ— éœ€æ‰‹åŠ¨è°ƒç”¨ä¿å­˜å‡½æ•°

### è‡ªåŠ¨åŠ è½½
- **è§¦å‘æ—¶æœº**: é¡µé¢åˆ·æ–°æˆ–é‡æ–°æ‰“å¼€
- **åŠ è½½æ–¹å¼**: Zustand è‡ªåŠ¨ä» LocalStorage è¯»å–
- **å¤±è´¥å¤„ç†**: å¦‚æœæ•°æ®æŸåï¼Œä½¿ç”¨é»˜è®¤å€¼

---

## ğŸ›¡ï¸ æ•°æ®å®‰å…¨æ€§

### ç‰ˆæœ¬æ§åˆ¶
```typescript
{
  version: 1,  // å½“å‰ç‰ˆæœ¬
}
```

**ä½œç”¨**:
- æœªæ¥æ›´æ–°æ—¶å¯ä»¥è¿›è¡Œæ•°æ®è¿ç§»
- ä¾‹å¦‚ v1 â†’ v2ï¼Œå¯ä»¥æ·»åŠ æ–°å­—æ®µæˆ–è½¬æ¢æ—§æ•°æ®

### æ•°æ®éªŒè¯
- Zustand + TypeScript è‡ªåŠ¨ç±»å‹æ£€æŸ¥
- æ— æ•ˆæ•°æ®ä¼šè¢«é‡ç½®ä¸ºé»˜è®¤å€¼

### æ•°æ®å¤‡ä»½å»ºè®®
1. å®šæœŸå¯¼å‡ºæ•°æ®ï¼š
   ```javascript
   // å¯¼å‡º
   const backup = localStorage.getItem('forgotten-realm-storage');
   console.log(backup); // å¤åˆ¶ä¿å­˜
   
   // å¯¼å…¥
   localStorage.setItem('forgotten-realm-storage', backup);
   location.reload();
   ```

2. ä½¿ç”¨æµè§ˆå™¨çš„"å¯¼å‡º/å¯¼å…¥"åŠŸèƒ½

---

## ğŸ§ª æµ‹è¯•æŒä¹…åŒ–åŠŸèƒ½

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æ¸¸æˆå¹¶è¿›å…¥æ¸¸æˆåœºæ™¯
2. ä½¿ç”¨ WASD ç§»åŠ¨ç©å®¶ï¼Œæ¢ç´¢å‡ ä¸ªåŒºåŸŸ
3. æŒ‰ M é”®æ‰“å¼€åœ°å›¾ï¼Œç¡®è®¤æ¢ç´¢åŒºåŸŸæ˜¾ç¤º
4. **åˆ·æ–°é¡µé¢** (F5)
5. é‡æ–°è¿›å…¥æ¸¸æˆ
6. æŒ‰ M é”®æ‰“å¼€åœ°å›¾

**é¢„æœŸç»“æœ**:
- âœ… ç©å®¶å‡ºç°åœ¨ä¸Šæ¬¡ç¦»å¼€çš„ä½ç½®
- âœ… åœ°å›¾ä¸Šæ˜¾ç¤ºä¹‹å‰æ¢ç´¢çš„åŒºåŸŸ
- âœ… æ¢ç´¢è¿›åº¦ä¿ç•™

---

## ğŸ“ å®ç°ç»†èŠ‚

### ä»£ç ä½ç½®
- **æ–‡ä»¶**: `src/store/gameStore.ts`
- **è¡Œæ•°**: 3è¡Œå¯¼å…¥ + 14è¡Œé…ç½® = **17è¡Œä»£ç **

### é…ç½®è¯´æ˜
```typescript
import { persist } from 'zustand/middleware';

export const useGameStore = create<GameState>()(
  persist(
    immer((set, get) => ({ /* çŠ¶æ€å’Œactions */ })),
    {
      name: 'forgotten-realm-storage',  // å­˜å‚¨é”®å
      partialize: (state) => ({         // é€‰æ‹©æ€§æŒä¹…åŒ–
        player: state.player,
        playerPosition: state.playerPosition,
        inventory: state.inventory,
        quests: state.quests,
        progress: state.progress,
        settings: state.settings,
      }),
      version: 1,  // ç‰ˆæœ¬å·
    }
  )
);
```

---

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- âœ… åŸºç¡€æŒä¹…åŒ–å®ç°
- âœ… é€‰æ‹©æ€§æ•°æ®ä¿å­˜

### ä¸­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] æ·»åŠ æ•°æ®å‹ç¼©ï¼ˆå¤§äº100KBæ—¶ï¼‰
- [ ] å®ç°å¤šå­˜æ¡£æ§½ä½ï¼ˆå­˜æ¡£1/2/3ï¼‰
- [ ] æ·»åŠ äº‘åŒæ­¥åŠŸèƒ½

### é•¿æœŸï¼ˆ1-2æœˆï¼‰
- [ ] ä½¿ç”¨ IndexedDB æ›¿ä»£ LocalStorageï¼ˆæ›´å¤§å®¹é‡ï¼‰
- [ ] å®ç°è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
- [ ] æ·»åŠ æ•°æ®åŠ å¯†

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Zustand Persist æ–‡æ¡£](https://github.com/pmndrs/zustand#persist-middleware)
- [LocalStorage MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage)
- [å·²å®ŒæˆåŠŸèƒ½æ€»ç»“](./å·²å®ŒæˆåŠŸèƒ½æ€»ç»“.md)
- [ä¸‹ä¸€æ­¥ä¼˜åŒ–è®¡åˆ’](./ä¸‹ä¸€æ­¥ä¼˜åŒ–è®¡åˆ’.md)

---

**"æ•°æ®æ°¸ä¸ä¸¢å¤±ï¼Œå†’é™©æ°¸ä¸åœæ­‡ï¼"** ğŸ’¾âœ¨
