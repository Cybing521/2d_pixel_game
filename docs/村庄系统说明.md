# 🏘️ 村庄系统说明

## 概念

**村庄** 是游戏中的安全区域，玩家可以在此休息、复活和补给。

---

## 📍 村庄位置

### 起始村庄
- **坐标**: (400, 300)
- **安全半径**: 150像素
- **功能**: 复活点 + 安全区

### 如何找到村庄

#### 在游戏中
1. 按 **M** 键打开地图
2. 查看黄色脉动圆圈 🟡
3. 那就是村庄位置

#### 在游戏场景中
1. 黄色圆圈区域
2. 中心有黄色脉动点（复活点）
3. 顶部显示"🏘️ 起始村庄"文字
4. 底部提示"安全区域 - 敌人不会进入"

---

## ⚡ 村庄功能

### 1️⃣ 复活点 ✅
**功能**: 玩家死亡后在此重生

**特点**:
- 死亡3秒后自动传送到村庄中心
- 复活时满血满蓝
- 清除所有敌人并重新生成

**视觉标记**:
- 黄色脉动圆点（中心）
- 地图上黄色光圈标记

---

### 2️⃣ 安全区 ✅
**功能**: 敌人无法进入的区域

**范围**: 
- 半径150像素圆形区域
- 黄色半透明圆圈显示边界

**效果**:
- ✅ 敌人不会在村庄内生成
- ✅ 敌人试图进入时被推出
- ✅ 玩家在村庄内不会被攻击
- ✅ 玩家可以安全回血

**机制**:
```typescript
// 每帧检测敌人位置
if (isInVillage(enemy.x, enemy.y)) {
  // 将敌人推到村庄边界外
  enemy.setPosition(boundaryX, boundaryY);
  enemy.setVelocity(0, 0);
}
```

---

### 3️⃣ 未来功能（计划中）

#### 商店 🏪
- 购买药水和装备
- 出售掉落物品
- 升级武器

#### NPC对话 💬
- 接受任务
- 了解世界观
- 获得提示

#### 传送点 🌀
- 快速传送到其他村庄
- 解锁新地图

#### 仓库 📦
- 存储物品
- 扩展背包

---

## 🎮 使用方法

### 如何前往村庄
```
1. 打开地图（M键）
2. 查看黄色村庄标记
3. 朝着村庄方向移动
4. 看到黄色圆圈即到达
```

### 在村庄中
```
✅ 可以做的事：
- 安全回血回蓝
- 整理背包
- 查看地图规划路线
- 等待技能冷却

❌ 不能做的事：
- 无法攻击（安全区）
- 没有敌人可战斗
```

### 死亡复活流程
```
玩家血量归零 
→ 死亡动画（3秒）
→ 传送到村庄中心
→ 满血满蓝复活
→ 敌人重新生成
```

---

## 📊 村庄数据

### 当前村庄
| 属性 | 数值 | 说明 |
|------|------|------|
| 名称 | 起始村庄 | 玩家出生地 |
| 位置 | (400, 300) | 世界坐标 |
| 半径 | 150px | 安全区范围 |
| 功能 | 复活点+安全区 | 基础功能 |

### 未来扩展
- **第二村庄**: (1200, 800) - 森林村庄
- **第三村庄**: (800, 1500) - 山脚村庄
- **城镇**: (1500, 1500) - 主城

---

## 🧪 测试村庄功能

### 测试1：查看村庄标记
```
1. 进入游戏
2. 观察起点附近
3. 应该看到：
   - 黄色圆圈区域
   - "🏘️ 起始村庄"文字
   - 黄色脉动复活点
   - "安全区域"提示
```

### 测试2：安全区功能
```
1. 在村庄内等待
2. 敌人从远处靠近
3. 敌人试图进入时会被推出
4. 玩家在村庄内不会被攻击
```

### 测试3：地图显示
```
1. 按M键打开地图
2. 查看村庄标记：
   - 黄色脉动光圈
   - 🏘️ 图标
   - 复活点圆圈
3. 图例中显示"复活点"和"村庄（安全区）"
```

### 测试4：复活机制
```
1. 离开村庄
2. 让敌人击杀
3. 等待3秒
4. 应该传送回村庄中心(400, 300)
5. 满血满蓝复活
```

---

## 🎨 视觉设计

### 游戏场景中
```
村庄标记组成：
1. 黄色圆圈区域（150px半径）
   - 填充：黄色10%透明
   - 边框：黄色50%透明，3px
   
2. 村庄名称文字
   - 位置：圆圈顶部
   - 文字：🏘️ 起始村庄
   - 颜色：黄色+黑色描边
   
3. 复活点标记
   - 位置：圆圈中心
   - 黄色圆点（8px）
   - 脉动动画
   
4. 提示文字
   - 位置：圆圈底部
   - 文字：安全区域 - 敌人不会进入
```

### 地图中
```
村庄标记组成：
1. 黄色脉动光圈（外层）
2. 黄色边框圆圈（中层）
3. 🏘️ 图标（中心）
4. 黄色圆点（复活点标记）
```

---

## 💡 设计理念

### 为什么需要村庄？

#### 1. 新手友好
- 提供安全的学习区域
- 玩家可以熟悉操作
- 不用担心被攻击

#### 2. 风险平衡
- 探索有风险（敌人）
- 村庄是避风港
- 创造紧张-放松循环

#### 3. 游戏节奏
- 战斗 → 探索 → 回村休息 → 再次出发
- 避免过度紧张
- 给玩家喘息空间

#### 4. 叙事基础
- 村庄是故事起点
- NPC提供任务
- 构建世界观

---

## 🔮 未来规划

### 短期（1-2周）
- [ ] 添加商店NPC
- [ ] 添加任务板
- [ ] 添加音乐（村庄主题曲）

### 中期（1个月）
- [ ] 第二个村庄
- [ ] 村庄传送系统
- [ ] 仓库功能

### 长期（2-3个月）
- [ ] 主城建设
- [ ] 村庄升级系统
- [ ] 村庄防御战

---

## 📝 技术实现

### 代码位置
- `src/game/scenes/GameScene.ts` 
  - `createVillage()` - 创建村庄标记
  - `isInVillage()` - 检测是否在村庄内
  - `update()` - 每帧检测敌人位置

- `src/ui/components/Map.tsx`
  - 地图上的村庄标记显示

### 关键代码
```typescript
// 村庄配置
private village = { 
  x: 400, 
  y: 300, 
  radius: 150 
};

// 安全区检测
private isInVillage(x: number, y: number): boolean {
  const distance = Phaser.Math.Distance.Between(
    x, y, 
    this.village.x, 
    this.village.y
  );
  return distance < this.village.radius;
}

// 敌人推出村庄
if (this.isInVillage(enemy.x, enemy.y)) {
  // 计算边界位置并推出
  enemy.setPosition(boundaryX, boundaryY);
  enemy.setVelocity(0, 0);
}
```

---

## ✅ 已实现功能

- [x] 村庄视觉标记（游戏场景）
- [x] 村庄标记（地图）
- [x] 复活点系统
- [x] 安全区域（敌人无法进入）
- [x] 敌人不在村庄内生成
- [x] 地图图例说明

---

## 🎉 总结

**村庄** 是游戏的核心安全机制：
- 🏠 安全的避难所
- 💚 复活和恢复点
- 🛡️ 免受敌人攻击
- 🗺️ 地图上清晰标记

**现在玩家有了安全的家园！** 🏘️✨

---

## 🔗 相关文档

- [复活和升级系统测试](./复活和升级系统测试.md)
- [测试敌人系统](./测试敌人系统.md)
- [修复说明](./修复说明.md)
