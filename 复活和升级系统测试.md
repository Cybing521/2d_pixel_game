# ✅ 复活和升级系统测试

## 🎯 新增功能

### 1️⃣ 复活点机制
- ✅ 玩家死亡后3秒在复活点重生
- ✅ 复活时满血满蓝
- ✅ 复活时清除所有敌人并重新生成
- ✅ 死亡提示文字
- ✅ 玩家死亡动画（变暗+旋转+透明）

### 2️⃣ 升级系统
- ✅ 经验条UI显示
- ✅ 经验值百分比显示
- ✅ 击杀敌人自动检查升级
- ✅ 升级提升属性（HP+10, MP+5）
- ✅ 升级特效（黄色文字+光圈）
- ✅ 升级自动回满血蓝

---

## 🧪 测试步骤

### 测试1：查看经验条

#### 步骤
1. 进入游戏
2. 查看HUD左上角

#### 预期结果
- ✅ HP血条（红色）
- ✅ MP蓝条（蓝色）
- ✅ **经验条（黄色）** ⭐ 新增
- ✅ 等级显示：Lv.1
- ✅ 经验值显示：0/100
- ✅ 经验百分比：0%

---

### 测试2：获得经验值

#### 步骤
1. 靠近敌人
2. 按空格攻击击杀敌人
   - 迷雾幽灵：30血，奖励10经验
   - 暗影之狼：50血，奖励20经验
3. 观察经验条变化

#### 预期结果（击杀1个幽灵）
- ✅ 控制台显示："获得 10 经验值，当前经验：10/100"
- ✅ 经验条增加到 10%
- ✅ 经验值显示：10/100
- ✅ 经验百分比：10%
- ✅ 经验条平滑动画（0.5秒过渡）

---

### 测试3：升级

#### 步骤
1. 击杀10个迷雾幽灵（10 x 10经验 = 100经验）
2. 或击杀5个暗影之狼（5 x 20经验 = 100经验）
3. 观察升级效果

#### 预期结果
- ✅ 玩家头顶显示大字：**"升级！Lv.2"** （黄色+红边）
- ✅ 黄色光圈从玩家扩散
- ✅ 升级文字向上飘并消失（2秒）
- ✅ 控制台显示："🎉 升级到 Lv.2！HP: 110, MP: 85"
- ✅ HUD显示：
  - 等级：Lv.2
  - HP：110/110（+10）
  - MP：85/85（+5）
  - 经验：0/150（剩余经验，新目标150）

#### 经验值公式
```javascript
// Lv1 → Lv2: 100经验
// Lv2 → Lv3: 150经验
// Lv3 → Lv4: 225经验
// 公式：100 * 1.5^(level-1)
```

---

### 测试4：玩家死亡

#### 步骤
1. 站在敌人攻击范围内不动
2. 让敌人持续攻击
3. 等待血量清零

#### 预期结果（血量到0时）
- ✅ 玩家停止移动
- ✅ 玩家变黑色
- ✅ 玩家旋转90度并变透明
- ✅ 屏幕中央显示红色大字：
  ```
  你死了...
  
  3秒后复活
  ```
- ✅ 控制台显示："玩家死亡，3秒后在复活点复活..."

---

### 测试5：复活机制

#### 步骤
1. 等待3秒（死亡后）
2. 观察复活效果

#### 预期结果
- ✅ 死亡提示消失
- ✅ 玩家传送到复活点（400, 300）
- ✅ 玩家恢复正常颜色和角度
- ✅ 玩家变回不透明
- ✅ HP满血（根据当前等级）
- ✅ MP满蓝（根据当前等级）
- ✅ 所有敌人消失
- ✅ 重新生成3个新敌人
- ✅ 控制台显示："玩家已在复活点复活"

---

## 📊 升级数据

### 等级属性表

| 等级 | HP | MP | 所需经验 | 累计经验 |
|------|----|----|----------|----------|
| Lv.1 | 100 | 80 | 100 | 0 |
| Lv.2 | 110 | 85 | 150 | 100 |
| Lv.3 | 120 | 90 | 225 | 250 |
| Lv.4 | 130 | 95 | 338 | 475 |
| Lv.5 | 140 | 100 | 507 | 813 |

### 敌人经验奖励

| 敌人 | 经验 | 击杀数（Lv1→2） |
|------|------|-----------------|
| 迷雾幽灵 | 10 | 10只 |
| 暗影之狼 | 20 | 5只 |

---

## 🎮 完整流程测试

### 测试场景：从Lv1升到Lv2再死亡

#### 步骤
1. 进入游戏（Lv.1, 0/100经验）
2. 击杀10个迷雾幽灵
3. 观察升级（Lv.2, 110HP, 85MP, 0/150经验）
4. 让敌人击杀自己
5. 观察死亡动画和提示
6. 等待3秒复活
7. 确认满血满蓝（110/110 HP, 85/85 MP）
8. 确认经验保留（0/150经验）

#### 预期控制台日志
```
获得 10 经验值，当前经验：10/100
获得 10 经验值，当前经验：20/100
...
获得 10 经验值，当前经验：100/100
🎉 升级到 Lv.2！HP: 110, MP: 85
迷雾幽灵 攻击玩家，造成 5 点伤害
玩家受到 5 点伤害，剩余血量：105/110
...
玩家受到 5 点伤害，剩余血量：0/110
Player died
玩家死亡，3秒后在复活点复活...
玩家已在复活点复活
生成了 3 个敌人
```

---

## 🔧 技术细节

### 复活点坐标
```typescript
private respawnPoint = { x: 400, y: 300 }; // 初始位置
```

### 经验值计算
```typescript
calculateExpToNextLevel(level: number): number {
  return Math.floor(100 * Math.pow(1.5, level - 1));
}

// Lv1: 100 * 1.5^0 = 100
// Lv2: 100 * 1.5^1 = 150
// Lv3: 100 * 1.5^2 = 225
```

### 升级属性提升
```typescript
newMaxHealth = oldMaxHealth + 10;  // +10 HP
newMaxMana = oldMaxMana + 5;        // +5 MP
```

---

## ✅ 验证清单

### 经验条UI
- [x] 经验条显示正确
- [x] 经验值数字显示
- [x] 经验百分比显示
- [x] 经验条动画流畅

### 升级系统
- [x] 击杀敌人获得经验
- [x] 经验达到要求自动升级
- [x] 升级特效显示
- [x] 升级提升属性
- [x] 升级回满血蓝
- [x] 经验值正确计算

### 复活系统
- [x] 玩家死亡动画
- [x] 死亡提示显示
- [x] 3秒后自动复活
- [x] 复活点位置正确
- [x] 复活时满血满蓝
- [x] 复活时清除敌人
- [x] 经验和等级保留

---

## 🐛 已知问题

### 待优化
1. 复活点目前固定，后续可添加多个复活点
2. 死亡时可能掉落经验（未实现）
3. 升级时可添加更多视觉效果

---

## 📝 代码统计

### 修改文件（3个）
1. **src/game/scenes/GameScene.ts**
   - +140行（复活、升级逻辑）
   
2. **src/game/entities/Player.ts**
   - +20行（死亡动画、复活方法）
   
3. **src/ui/components/HUD.tsx**
   - +20行（经验条UI）

### 总计
- **新增**: ~180行
- **功能**: 2个完整系统

---

## 🎉 测试完成

如果所有测试通过，恭喜！复活和升级系统已成功实现！

**现在游戏有完整的成长和容错机制了！** ⚔️✨📈

---

## 🔗 相关功能

- [测试敌人系统](./测试敌人系统.md)
- [修复说明](./修复说明.md)
- [P0任务完成总结](./P0任务完成总结.md)
